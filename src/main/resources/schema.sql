DROP TABLE IF EXISTS FILM CASCADE;

DROP TABLE IF EXISTS FILM_GENRE CASCADE;

DROP TABLE IF EXISTS FILM_LIKE CASCADE;

DROP TABLE IF EXISTS FRIENDSHIP CASCADE;

DROP TABLE IF EXISTS GENRE CASCADE;

DROP TABLE IF EXISTS RATING CASCADE;

DROP TABLE IF EXISTS USERS CASCADE;

DROP TABLE IF EXISTS REVIEW CASCADE;

DROP TABLE IF EXISTS REVIEW_LIKE CASCADE;

DROP TABLE IF EXISTS EVENTS CASCADE;

DROP TABLE IF EXISTS DIRECTORS CASCADE;

DROP TABLE IF EXISTS DIRECTOR_FILMS CASCADE;

CREATE TABLE IF NOT EXISTS RATING(
    rating_id INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,
    name CHARACTER VARYING
);

CREATE TABLE IF NOT EXISTS FILM(
    film_id INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,
    name CHARACTER VARYING NOT NULL,
    description CHARACTER VARYING,
    release_date DATE,
    duration INTEGER,
    rating_id INTEGER REFERENCES RATING(RATING_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS GENRE(
    GENRE_ID integer AUTO_INCREMENT NOT NULL PRIMARY KEY,
    NAME CHARACTER VARYING
);

CREATE TABLE IF NOT EXISTS FILM_GENRE(
    FILM_GENRE_ID INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,
    FILM_ID INTEGER NOT NULL REFERENCES FILM(FILM_ID) ON DELETE CASCADE,
    GENRE_ID INTEGER NOT NULL REFERENCES GENRE(GENRE_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS USERS(
    USER_ID INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,
    EMAIL CHARACTER VARYING,
    LOGIN CHARACTER VARYING,
    NAME CHARACTER VARYING,
    BIRTHDAY DATE
);

CREATE TABLE IF NOT EXISTS FILM_LIKE(
    LIKE_ID INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,
    FILM_ID INTEGER NOT NULL REFERENCES FILM(FILM_ID) ON DELETE CASCADE,
    USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS FRIENDSHIP(
    FRIENDSHIP_ID INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,
    USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    FRIEND_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    IS_CONFIRMED BOOLEAN
);

CREATE TABLE IF NOT EXISTS REVIEW(
    REVIEW_ID INTEGER AUTO_INCREMENT NOT NULL PRIMARY KEY,
    CONTENT CHARACTER VARYING NOT NULL,
    IS_POSITIVE BOOLEAN NOT NULL,
    USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID),
    FILM_ID INTEGER NOT NULL REFERENCES FILM(FILM_ID),
    USEFUL INTEGER
);

CREATE TABLE IF NOT EXISTS REVIEW_LIKE(
    REVIEW_ID INTEGER NOT NULL REFERENCES FILM(FILM_ID) ON DELETE CASCADE PRIMARY KEY,
    USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    IS_LIKE BOOLEAN
);

CREATE TABLE IF NOT EXISTS DIRECTORS(
    DIRECTOR_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(256) NOT NULL
);

CREATE TABLE IF NOT EXISTS DIRECTOR_FILMS(
    DIRECTOR_ID BIGINT NOT NULL REFERENCES DIRECTORS(DIRECTOR_ID) ON DELETE CASCADE,
    FILM_ID BIGINT NOT NULL REFERENCES FILM(FILM_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS EVENTS(
    ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    USER_ID INTEGER REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    OPERATION CHARACTER VARYING NOT NULL,
    EVENT_TYPE CHARACTER VARYING NOT NULL,
    TIMESTAMP TIMESTAMP DEFAULT LOCALTIMESTAMP,
    ENTITY_ID INTEGER
);